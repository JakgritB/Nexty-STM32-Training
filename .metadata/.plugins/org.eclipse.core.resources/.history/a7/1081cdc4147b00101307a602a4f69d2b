#include <stdint.h>
#define STM32F411xE
#include "stm32f4xx.h"

char stringOut[15] = "Hello world!\n";
const uint32_t THRESHOLD = 1333333;

void vdg_UART_TxString(char strOut[]) {
	for (uint8_t idx = 0; strOut[idx] != '\0'; idx++) {
		while((USART2->SR & USART_SR_RXNE) == 0);
		USART2->DR = strOut[idx];
	}
}

int main(void) {
	RCC->AHB1ENR |= RCC_AHB1ENR_GPIOAEN;
	RCC->APB1ENR |= RCC_APB1ENR_USART2EN;

	GPIOA->MODER &= ~(GPIO_MODER_MODER2 | GPIO_MODER_MODER3);
	GPIOA->MODER |= (0b10 << GPIO_MODER_MODER2_Pos) + (0b10 << GPIO_MODER_MODER3_Pos);
	GPIOA->AFR[0] &= ~(GPIO_AFRL_AFRL2 | GPIO_AFRL_AFRL3);
	GPIOA->AFR[0] |= (0b0111 << GPIO_AFRL_AFSEL2_Pos) + (0b0111 << GPIO_AFRL_AFSEL3_Pos);

	USART2->CR1 |= USART_CR1_UE;
	USART2->CR1 &= ~ USART_CR1_M;
	USART2->CR2 &= ~ USART_CR2_STOP;
	USART2->BRR = 139;
	USART2->CR1 |= USART_CR1_TE;

	while(1) {
		vdg_UART_TxString(stringOut);
		for (uint32_t iter = 0; iter < THRESHOLD; iter++) {

		}
	}
	return 0 ;
}
